name: Github-Actions-CI

# Controls when the action will run. Triggers the workflow on push or pull request 
# events but only for the master branch
on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  lint:
    name: lint
    runs-on: ubuntu-latest
    steps:
      - name: checkbadchars
        run: >
          test $(grep -caxv '.*' *.f *.f90 *.h  README* |
          cut -d: -f2 | awk '{ SUM += $1} END { print SUM }') -eq 0

      - name: enforce_unixish
        run: test $(file -k  *.f *.f90 *.h | grep -c "CRLF") -eq 0

  build-and-test:
    runs-on: ubuntu-latest
    steps: 
      - name: compile
        uses: docker://csmiet/testspec
        with: 
          args: make CC=gfortran xspec
      - name: stable_force_free_sheet
        uses: docker://csmiet/testspec
        with:
          args: source source.sh; cd ci/G1V03L2Fi; xspec G1V03L2Fi.001.sp; python3 -m py_spec.ci.test G1V03L2Fi.001.sp.h5 compare.h5
          
